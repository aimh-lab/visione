<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
<meta name="task" content="AVS">
<meta name="dataset" content="mvk">

<title>Episode IV-A New Hope in VISIONE</title>
<link rel="stylesheet" href="css/jquery-ui.min.css">
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/visione.css">
<link rel="stylesheet" href="css/AVSLayout.css">
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/fabric.js"></script>
<script src="js/visione.js"></script>
<script src="js/visioneAVS.js"></script>
<script src="js/canvas.js"></script>
<script src="js/search_bar_templates.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@viselect/vanilla/lib/viselect.cjs.js"></script>

</head>

<body oncontextmenu="return false;">

	<div id="content" class="containerGrid">
		<div class="headerGrid">
			<table>
  	<tr>
  	<td colspan=1 valign="top">
  	
  		  		<div align="left" style="padding-top: 8px; padding-bottom: 5px;">
			<span style="float: left; padding-left: 5px; padding-right: 5px;">
			<span class="task">AVS</span>
			
			<div class="dropdown">
		  		<button
					id="newsession" class="btn btn-warning btn-sm"
					title="Start a new Session">
					<i class="fa fa-play">New Session</i>
				</button>
		  <div class="dropdown-content">
		  <a href="" onclick="startNewMVKKISSession(); return false;">KIS</a>
		  <a href="" onclick="startNewMVKAVSSession(); return false;">AVS</a>
		  </div>
		</div>
			
			</span> <img src="img/logoVISIONE.png" height="28px"
				style="border-radius: 20px 20px 20px 20px;" alt=""> <img
				src="img/cropped-aimh_logo5-1024x372.png" height="28px"
				style="border-radius: 20px 20px 20px 20px;" alt="">
				
		</div>
		<div id="dialog" title="Tag Name">
			<label>tag</label> <input id="tag" name="tag" type="text">
		</div>
			<br>
			<div w3-include-html="paletteMVK.html" style="padding-left: 5px;"></div>
		
  	
  	</td>
  	<td>
  		<div><button
					id="v3c" class="btn btn-outline-primary btn-sm"
					title="Switch to V3C dataset" onclick="v3cTab();">
					<i class="fa fa-fish"> Marine Dataset</i>
				</button></div>
  		<div id="avsTab" style="height: 15vh; width: 78vw; overflow: auto;"></div>
  	</td>
  	</tr>
</table>
		</div>
		<div class="bodyGrid">
			<div class="sidebarGrid">
				<div id='searchTab'></div>
				<hr>
				<div w3-include-html="filters.html" style="padding-left: 5px;""></div>
				
			</div>
			<div class="contentGrid" id="content">
				<div id='results'></div>
				<ol id="recordingsList"></ol>
				
			</div>
			<div class="rightSidebarGrid" id="submitted_bar" style="display:none;">
				<div style="color:green; font-size: larger;"> Submitted: <b id="submitted_num" style="color: red; font-size:large;"></b></div>
				<div id="avsSubmittedTab"></div>
			</div>
		</div>
	</div>

	<script>
		$(document)
				.ready(
						function() {

							$(function() {
								$("#dialog").dialog({
									autoOpen : false
								});
							});
							includeHTML();
							setCollection("mvk")

							$("#searchTab").append(searchForm(0));
							//$("#searchTab").append("<div><img src='img/bug.gif' width=30 height=15></div>")
							//$("#searchTab").append(addButton);
							$("#searchTab").append(searchForm(1));
							//$("#searchTab").append(addButton);

							canvas0 = get_canvas('canvas0', 'annotations0',
									'not0');
							canvas1 = get_canvas('canvas1', 'annotations1',
									'not1');
							canvases = [ canvas0, canvas1 ];

							$('#content').on('drop', dropImage);

							$("#clean0").on('click', function(e) {
								if (!isCanvasClean[0]) {
									isCanvasClean[0] = true;
									canvasClean(0);
									searchByForm();
									//performSearch(cell2Text(0), cell2Text(1));
								}
							});

							$("#clean1").on('click', function(e) {
								if (!isCanvasClean[1]) {
									isCanvasClean[1] = true;
									canvasClean(1);
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#reset").on('click', function(e) {
								if (!isReset) {
									isReset = true;
									reset();
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#textual0")
									.keyup(
											function(event) {
												if (event.keyCode === 13) {
													$("#textual0").val($("#textual0").val().replace(/(\r\n|\n|\r)/gm,""));
													queryByTextual();
												}
											});
							$("#textual1")
									.keyup(
											function(event) {
												if (event.keyCode === 13) {
													$("#textual1").val($("#textual1").val().replace(/(\r\n|\n|\r)/gm,""));
													queryByTextual();
												}
											})

							$("#undo0").on('click', function(e) {
								if (isCanvasClean[0]) {
									isCanvasClean[0] = false;
									canvasCleanUndo(0);
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#undo1").on('click', function(e) {
								if (isCanvasClean[1]) {
									isCanvasClean[1] = false;
									canvasCleanUndo(1);
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#undoReset").on('click', function(e) {
								if (isReset) {
									isReset = false;
									undoReset();
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});
							
							$("#recordButton0").on('click', function(e) {
								document.getElementById("recordButton0").style.display = 'none';
								document.getElementById("stopButton0").style.display = 'block';
								startRecording(0);
							});

							$("#recordButton1").on('click', function(e) {
								document.getElementById("recordButton1").style.display = 'none';
								document.getElementById("stopButton1").style.display = 'block';
								startRecording(1);

							});

							$("#stopButton0").on('click', function(e) {
								document.getElementById("recordButton0").style.display = 'block';
								document.getElementById("stopButton0").style.display = 'none';
								stopRecording(0);
							});

							$("#stopButton1").on('click', function(e) {
								document.getElementById("recordButton1").style.display = 'block';
								document.getElementById("stopButton1").style.display = 'none';
								stopRecording(1);
							});

							canvas0.renderAll();
							
							var script = document.createElement('script');					          
					        script.src = "js/WebAudioRecorder/WebAudioRecorder.min.js"; 
					        document.head.appendChild(script)
					        script = document.createElement('script');					          
					        script.src = "js/WebAudioRecorder/audioRecorder.js"; 
					        document.head.appendChild(script);
						});
	</script>
	
	<!-- inserting these scripts at the end to be able to use all the elements in the DOM 
	<script src="js/WebAudioRecorder/WebAudioRecorder.min.js"></script>
	<script src="js/WebAudioRecorder/audioRecorder.js"></script>-->
	

</body>
</html>