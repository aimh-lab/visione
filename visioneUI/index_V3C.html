<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy"
	content="upgrade-insecure-requests" />
<meta name="task" content="KIS">
<meta name="dataset" content="v3c">

<title>Episode IV-A New VISIONE</title>
<link rel="stylesheet" href="css/jquery-ui.min.css">
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/visione.css">
<link rel="stylesheet" href="css/toggle.css">
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/fabric.js"></script>
<script src="js/visione.js"></script>
<script src="js/visioneAVS.js"></script>
<script src="js/canvas.js"></script>
<script src="js/search_bar_templates.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/@viselect/vanilla/lib/viselect.cjs.js"></script>


<style>
body {
	overflow: hidden;
}

.containerGrid {
	height: 100vh;
	width: 100vw;
	display: grid;
	grid-template-columns: 1fr;
	grid-template-rows: 190px 1fr 30px;
}

.headerGrid {
	border-bottom: 0px solid lightgrey;
}

.sidebarGrid {
	border-right: 0px solid lightgrey;
	max-width: 330px;
	overflow-y: auto;
	padding: 5px;
}

.footerGrid {
	border-top: 0px solid lightgrey;
}

.bodyGrid {
	display: grid;
	grid-template-columns: 1fr 4.2fr;
	overflow: hidden;
}

.contentGrid {
	overflow-y: auto;
	padding: 0px;
	border-left: 0px solid green;
}
</style>

</head>

<body oncontextmenu="return false;">

	<div id="content" class="containerGrid">
		<div class="headerGrid">

			<table border="0">
				<tr>

					<td>
						<span id="visionelogo_sidebar"></span>

					</td>
					<td colspan="2">
						<div  style="float: right;" class="tg-list-item">
							<input class="tgl tgl-skewed" id="cb3" type="checkbox" onclick="displayAdvancedToggle();" checked/>

							<label class="tgl-btn" data-tg-off="OFF" data-tg-on="ON" for="cb3"></label>
							
						</div>
						<div style="float: right; font-size: larger; font-weight: bold;">ADVANCED MODE </div>
						<div style="float: right; padding-right: 4%;">
							<button id="newsession" class="btn btn-warning btn-sm"
								title="Start a new Session" onclick="startNewKISSession()">
								<i class="fa fa-play"> New Session</i>
							</button>
						</div>
						
					</td>
				</tr>
				<tr>
					<td colspan=1 valign="top" style="min-width: 350px;">
						<div id="collectionsTab" align="left" style="padding: 4px;padding-bottom: 20px;">
									<div style="float: left; padding-right: 4px;">
										<button disabled="disabled" class="btn btn-info btn-sm"
											title="You are running a V3C KIS task">
											<i class="fa fa-home"> V3C KIS</i>

										</button>
									</div>
									<div style="float: left; padding-right: 16px;"onclick="startNewAVSSession();">
										<button 
											class="btn btn-outline-info btn-sm"
											title="Switch to V3C AVS Dataset">
											<i class="fa fa-home"> V3C AVS</i>

										</button>
									</div>
									<div style="float: left; padding-left: 4px;"
										onclick="startNewMVKKISSession();">
										<button class="btn btn-outline-primary btn-sm"
											title="Switch to MVK Dataset">
											<i class="fa fa-fish"> MVK</i>

										</button>
									</div>
									
						</div>
						<div id="dialog" title="Tag Name">
							<label>tag</label> <input id="tag" name="tag" type="text">
						</div> <br>
						<div w3-include-html="palette.html" style="padding-left: 5px;"></div>


					</td>
					<td>
						<div class="advanced" style="float: left; padding-left: 30px; padding-top: 5px">
							<b style="font-size: 140%;"><input id='simreorder'
								type="checkbox" onchange="setSimReorder(this)">&nbsp;Sim
								Reorder</b>
						</div>
						<span id="visionelogo_central">
							<div id="visionelogo" align="center" style="float: left; padding-left: 30%;">
								<img src="img/logoVISIONE.png" height="28px"
									style="border-radius: 20px 20px 20px 20px;" alt=""> <img
									src="img/cropped-aimh_logo5-1024x372.png" height="28px"
									style="border-radius: 20px 20px 20px 20px;" alt="">
							</div>
						</span>

						<div class="simplified0" style="float: left; padding-left: 50px; padding-top: 5px" id="simplified0"></div>
						<div class="simplified1" style="float: right; padding-right: 50px; padding-top: 5px" id="simplified1"></div>

						<div id="avsTab"
							style="height: 15vh; width: 78vw; overflow: auto;"></div>
					</td>
					<td></td>
				</tr>
			</table>
		</div>
		<div class="bodyGrid">
			<div class="sidebarGrid" id="searchSidebar">
				<div id='searchTab'></div>
				<hr class="advanced">
				<div w3-include-html="filters.html" style="padding-left: 5px;"></div>

			</div>
			<div class="contentGrid" id="content">
				<div id='results'></div>
				<ol id="recordingsList"></ol>

			</div>
		</div>
	</div>

	<script>
		$(document)
				.ready(
						function() {

							$(function() {
								$("#dialog").dialog({
									autoOpen : false
								});
							});
							includeHTML();
							setCollection("v3c")

							$("#searchTab").append(searchForm(0));
							//$("#searchTab").append("<div><img src='img/bug.gif' width=30 height=15></div>")
							//$("#searchTab").append(addButton);
							$("#searchTab").append(searchForm(1));
							//$("#searchTab").append(addButton);

							canvas0 = get_canvas('canvas0', 'annotations0',
									'not0');
							canvas1 = get_canvas('canvas1', 'annotations1',
									'not1');
							canvases = [ canvas0, canvas1 ];

							$('#content').on('drop', dropImage);

							$("#clean0").on('click', function(e) {
								if (!isCanvasClean[0]) {
									isCanvasClean[0] = true;
									canvasClean(0);
									searchByForm();
									//performSearch(cell2Text(0), cell2Text(1));
								}
							});

							$("#clean1").on('click', function(e) {
								if (!isCanvasClean[1]) {
									isCanvasClean[1] = true;
									canvasClean(1);
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#reset").on('click', function(e) {
								if (!isReset) {
									isReset = true;
									reset();
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#textual0")
									.keyup(
											function(event) {
												if (event.keyCode === 13) {
													$("#textual0")
															.val(
																	$(
																			"#textual0")
																			.val()
																			.replace(
																					/(\r\n|\n|\r)/gm,
																					""));
													queryByTextual();
												}
											});
							$("#textual1")
									.keyup(
											function(event) {
												if (event.keyCode === 13) {
													$("#textual1")
															.val(
																	$(
																			"#textual1")
																			.val()
																			.replace(
																					/(\r\n|\n|\r)/gm,
																					""));
													queryByTextual();
												}
											})

							$("#undo0").on('click', function(e) {
								if (isCanvasClean[0]) {
									isCanvasClean[0] = false;
									canvasCleanUndo(0);
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#undo1").on('click', function(e) {
								if (isCanvasClean[1]) {
									isCanvasClean[1] = false;
									canvasCleanUndo(1);
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							$("#undoReset").on('click', function(e) {
								if (isReset) {
									isReset = false;
									undoReset();
									//performSearch(cell2Text(0), cell2Text(1));
									searchByForm();
								}
							});

							var blink0 = null;
							var blink1 = null;

							$("#recordButton0")
									.on(
											'click',
											function(e) {
												if ($("#recordButton0").css('color') == "rgb(0, 128, 0)") {
													$("#recordButton0").css('color', 'red');
													blink0 = setInterval(() => {
														$('#recordButton0').fadeIn();
														$('#recordButton0').fadeOut();
													}, 100);
													
													startRecording(0);
												}
												else {
													clearInterval(blink0);
													$('#recordButton0').finish();
													$('#recordButton0').show();
													$("#recordButton0").css('color', 'green');

													//stopRecording(0);

												}
											});

							$("#recordButton1")
									.on(
											'click',
											function(e) {
												if ($("#recordButton1").css('color') == "rgb(0, 128, 0)") {
													$("#recordButton1").css('color', 'red');
													blink1 = setInterval(() => {
														$('#recordButton1').fadeIn();
														$('#recordButton1').fadeOut();
													}, 100);
													startRecording(1);
												}
												else {
													clearInterval(blink1);
													$('#recordButton1').finish();
													$('#recordButton1').show();
													$("#recordButton1").css('color', 'green');
													stopRecording(1);

												}

										});
/*
							$("#stopButton0")
									.on(
											'click',
											function(e) {
												document
														.getElementById("recordButton0").style.display = 'block';
												document
														.getElementById("stopButton0").style.display = 'none';
												stopRecording(0);
											});

							$("#stopButton1")
									.on(
											'click',
											function(e) {
												document
														.getElementById("recordButton1").style.display = 'block';
												document
														.getElementById("stopButton1").style.display = 'none';
												stopRecording(1);
											});
*/
							canvas0.renderAll();

							var script = document.createElement('script');
							script.src = "js/WebAudioRecorder/WebAudioRecorder.min.js";
							document.head.appendChild(script)
							script = document.createElement('script');
							script.src = "js/WebAudioRecorder/audioRecorder.js";
							document.head.appendChild(script)

							const microphoneIcon = document.querySelector('.microphone-icon');
							const inputText = document.querySelector('input[type="text"]');
						  
							microphoneIcon.addEventListener('click', () => {
							  // Avvia la registrazione audio
							  console.log('Registrazione audio avviata');
							});

						});
	</script>

	<!-- inserting these scripts at the end to be able to use all the elements in the DOM 
	<script src="js/WebAudioRecorder/WebAudioRecorder.min.js"></script>
	<script src="js/WebAudioRecorder/audioRecorder.js"></script>-->


</body>
</html>